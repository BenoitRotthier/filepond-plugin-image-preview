/*
 * FilePondPluginImagePreview 4.0.0
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */

/* eslint-disable */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginImagePreview=t()}(this,function(){"use strict";var o={type:"spring",stiffness:.5,damping:.45,mass:10},v=function(e,t){return{x:e,y:t}},c=function(e,t){return v(e.x-t.x,e.y-t.y)},I=function(e,t){return Math.sqrt((r=c(i=e,a=t),n=c(i,a),r.x*n.x+r.y*n.y));var i,a,r,n},_=function(e,t){var i=e,a=t,r=1.5707963267948966-t,n=Math.sin(1.5707963267948966),o=Math.sin(a),c=Math.sin(r),s=Math.cos(r),l=i/n;return v(s*(l*o),s*(l*c))},w=function(e,t,i,a){var r,n,o,c,s,l,h,d,f,p=.5<a.x?1-a.x:a.x,u=.5<a.y?1-a.y:a.y,g=2*p*e.width,E=2*u*e.height,m=(n=i,o=(r=t).width,c=r.height,s=_(o,n),l=_(c,n),h=v(r.x+Math.abs(s.x),r.y-Math.abs(s.y)),d=v(r.x+r.width+Math.abs(l.y),r.y+Math.abs(l.x)),f=v(r.x-Math.abs(l.y),r.y+r.height-Math.abs(l.x)),{width:I(h,d),height:I(h,f)});return Math.max(m.width/g,m.height/E)},s=function(e){return e.utils.createView({name:"image-bitmap",tag:"canvas",ignoreRect:!0,mixins:{styles:["scaleX","scaleY"]},create:function(e){var t,i,a=e.root,r=e.props;t=r.image,(i=(i=a.element)||document.createElement("canvas")).width=t.width,i.height=t.height,i.getContext("2d").drawImage(t,0,0)}})},r=function(n){return n.utils.createView({name:"image-clip",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["width","height","opacity"],animations:{opacity:{type:"tween",duration:250}}},create:function(e){var a,t=e.root,i=e.props;t.ref.image=t.appendChildView(t.createChildView((a=n).utils.createView({name:"image-canvas-wrapper",tag:"div",ignoreRect:!0,mixins:{apis:["crop","width","height"],styles:["originX","originY","translateX","translateY","scaleX","scaleY","rotateZ"],animations:{originX:o,originY:o,scaleX:o,scaleY:o,translateX:o,translateY:o,rotateZ:o}},create:function(e){var t=e.root,i=e.props;i.width=i.image.width,i.height=i.image.height,t.ref.image=t.appendChildView(t.createChildView(s(a),{image:i.image}))},write:function(e){var t=e.root,i=e.props.crop.flip,a=t.ref.image;a.scaleX=i.horizontal?-1:1,a.scaleY=i.vertical?-1:1}}),Object.assign({},i)));var r=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==r&&(t.element.dataset.transparencyIndicator="grid"===r?r:"color")},write:function(e){var t=e.root,i=e.props,a=e.shouldOptimize,r=i.crop,n=i.width,o=i.height;t.ref.image.crop=r;var c,s,l,h,d={x:0,y:0,width:n,height:o,center:{x:.5*n,y:.5*o}},f={width:t.ref.image.width,height:t.ref.image.height},p={x:r.center.x*f.width,y:r.center.y*f.height},u={x:d.center.x-f.width*r.center.x,y:d.center.y-f.height*r.center.y},g=2*Math.PI+r.rotation%(2*Math.PI),E=r.aspectRatio||f.height/f.width,m=w(f,(l=(c=d).width,(h=l*(s=E))>c.height&&(l=(h=c.height)/s),{x:.5*(c.width-l),y:.5*(c.height-h),width:l,height:h}),g,r.center),v=r.zoom*m,I=t.ref.image;if(a)return I.originX=null,I.originY=null,I.translateX=null,I.translateY=null,I.rotateZ=null,I.scaleX=null,void(I.scaleY=null);I.originX=p.x,I.originY=p.y,I.translateX=u.x,I.translateY=u.y,I.rotateZ=g,I.scaleX=v,I.scaleY=v}})},n="<radialGradient id=\"filepond--image-preview-radial-gradient\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\n<stop offset='50%' stop-color='#000000'/>\n<stop offset='56%' stop-color='#0a0a0a'/>\n<stop offset='63%' stop-color='#262626'/>\n<stop offset='69%' stop-color='#4f4f4f'/>\n<stop offset='75%' stop-color='#808080'/>\n<stop offset='81%' stop-color='#b1b1b1'/>\n<stop offset='88%' stop-color='#dadada'/>\n<stop offset='94%' stop-color='#f6f6f6'/>\n<stop offset='100%' stop-color='#ffffff'/>\n</radialGradient>\n\n<mask id=\"filepond--image-preview-masking\">\n<rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#filepond--image-preview-radial-gradient)\"></rect>\n</mask>",e=function(){if(document.body&&!document.querySelector(".filepond--image-preview-sprite")){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","filepond--image-preview-sprite"),e.style.cssText="position:absolute;width:0;height:0",e.innerHTML=n,document.body.appendChild(e)}},t="undefined"!=typeof navigator;t&&(e(),document.addEventListener("readystatechange",e));var h=!!t&&(document.documentMode||/Edge/.test(navigator.userAgent)),d=function(){self.onmessage=function(t){createImageBitmap(t.data.message.file).then(function(e){self.postMessage({id:t.data.id,message:e},[e])})}},l={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},m=function(e,t,i,a){-1!==a&&e.transform.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(l[a](t,i)))},y=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},T=function(e,t){return Math.floor(Math.sqrt(e/(t/4)))},p=function(s){var a,i=s.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,i=e.props;t.element.classList.add("filepond--image-preview-overlay-"+i.status),t.element.innerHTML='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n                '+(h?"<defs>"+n+"</defs>":"")+'\n                <rect x="0" width="500" height="200" fill="currentColor" mask="url(#filepond--image-preview-masking)"></rect>\n            </svg>\n            '},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),l=(a=s).utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,mixins:{apis:["crop"],styles:["translateY","scaleX","scaleY","opacity"],animations:{scaleX:o,scaleY:o,translateY:o,opacity:{type:"tween",duration:400}}},create:function(e){var t=e.root,i=e.props;t.ref.clip=t.appendChildView(t.createChildView(r(a),{image:i.image,crop:i.crop}))},write:function(e){var t=e.root,i=e.props,a=e.shouldOptimize,r=t.ref.clip,n=i.crop,o=i.image;if(r.crop=n,r.opacity=a?0:1,!a){var c=o.height/o.width,s=n.aspectRatio||c,l=t.rect.inner.width,h=t.rect.inner.height,d=t.query("GET_IMAGE_PREVIEW_HEIGHT"),f=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),p=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),u=t.query("GET_PANEL_ASPECT_RATIO"),g=t.query("GET_ALLOW_MULTIPLE");u&&!g&&(d=l*u,s=u);var E=null!==d?d:Math.max(f,Math.min(l*s,p)),m=E/s;l<m&&(E=(m=l)*s),h<E&&(m=(E=h)/s),r.width=m,r.height=E}}}),E=function(e){var t=e.root,i=e.props,a=i.id,r=t.query("GET_ITEM",{id:a});if(r){var n=i.preview,o=r.getMetadata("crop")||{center:{x:.5,y:.5},flip:{horizontal:!1,vertical:!1},zoom:1,rotation:0,aspectRatio:null},c=t.appendChildView(t.createChildView(l,{image:n,crop:o,opacity:0,scaleX:1.15,scaleY:1.15,translateY:15}),t.childViews.length);t.ref.images.push(c),c.opacity=1,c.scaleX=1,c.scaleY=1,c.translateY=0,setTimeout(function(){t.dispatch("DID_IMAGE_PREVIEW_SHOW",{id:a})},250)}},e=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},t=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1};return s.utils.createView({name:"image-preview-wrapper",create:function(e){var t=e.root;t.ref.images=[],t.ref.imageViewBin=[],t.ref.overlayShadow=t.appendChildView(t.createChildView(i,{opacity:0,status:"idle"})),t.ref.overlaySuccess=t.appendChildView(t.createChildView(i,{opacity:0,status:"success"})),t.ref.overlayError=t.appendChildView(t.createChildView(i,{opacity:0,status:"failure"}))},styles:["height"],apis:["height"],write:s.utils.createRoute({DID_IMAGE_PREVIEW_DRAW:function(e){var t=e.root,i=t.ref.images[t.ref.images.length-1];i.translateY=0,i.scaleX=1,i.scaleY=1,i.opacity=1},DID_IMAGE_PREVIEW_CONTAINER_CREATE:function(e){var f=e.root,p=e.props,r=s.utils.createWorker,n=p.id,u=f.query("GET_ITEM",n);if(u){var t,i,a,g=URL.createObjectURL(u.file),o=function(){var a;(a=g,new Promise(function(e,t){var i=new Image;i.crossOrigin="Anonymous",i.onload=function(){e(i)},i.onerror=function(e){t(e)},i.src=a})).then(c)},c=function(e){URL.revokeObjectURL(g);var t=(u.getMetadata("exif")||{}).orientation||-1,i=e.width,a=e.height;if(5<=t&&t<=8){var r=[a,i];i=r[0],a=r[1]}var n=window.devicePixelRatio,o=a/i,c=f.rect.element.width,s=f.rect.element.height,l=0,h=0;1<o?h=(l=c)*o:l=(h=s)/o,p.preview=function(e,t,i,a){t=Math.round(t),i=Math.round(i);var r=document.createElement("canvas");r.width=t,r.height=i;var n=r.getContext("2d");if(5<=a&&a<=8){var o=[i,t];t=o[0],i=o[1]}return m(n,t,i,a),n.drawImage(e,0,0,t,i),r}(e,Math.min(i,l*n*4),Math.min(a,h*n*4),t);var d=f.query("GET_IMAGE_PREVIEW_CALCULATE_AVERAGE_IMAGE_COLOR")?function(e){var t=Math.min(10/e.width,10/e.height),i=document.createElement("canvas"),a=i.getContext("2d"),r=i.width=Math.ceil(e.width*t),n=i.height=Math.ceil(e.height*t);a.drawImage(e,0,0,r,n);var o=null;try{o=a.getImageData(0,0,r,n).data}catch(e){return null}for(var c=o.length,s=0,l=0,h=0,d=0;d<c;d+=4)s+=o[d]*o[d],l+=o[d+1]*o[d+1],h+=o[d+2]*o[d+2];return{r:s=T(s,c),g:l=T(l,c),b:h=T(h,c)}}(e):null;u.setMetadata("color",d,!0),"close"in e&&e.close(),f.ref.overlayShadow.opacity=1,E({root:f,props:p})};t=g,i=function(e,t){if(f.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:n,width:e,height:t}),a=u.file,"createImageBitmap"in window&&y(a)){var i=r(d);i.post({file:u.file},function(e){i.terminate(),e?c(e):o()})}else o();var a},(a=new Image).onload=function(){var e=a.naturalWidth,t=a.naturalHeight;a=null,i(e,t)},a.src=t}},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;if("crop"===e.action.change.key&&t.ref.images.length){var a=t.query("GET_ITEM",{id:i.id});if(a){var r,n,o,c,s,l,h=a.getMetadata("crop"),d=t.ref.images[t.ref.images.length-1];1e-5<Math.abs(h.aspectRatio-d.crop.aspectRatio)?((l=(s={root:t}.root).ref.images.shift()).opacity=0,l.translateY=-15,s.ref.imageViewBin.push(l),E({root:t,props:i})):(n=(r={root:t,props:i}).root,o=r.props,(c=n.query("GET_ITEM",{id:o.id}))&&(n.ref.images[n.ref.images.length-1].crop=c.getMetadata("crop")))}}},DID_THROW_ITEM_LOAD_ERROR:t,DID_THROW_ITEM_PROCESSING_ERROR:t,DID_THROW_ITEM_INVALID:t,DID_COMPLETE_ITEM_PROCESSING:function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:e,DID_REVERT_ITEM_PROCESSING:e},function(e){var i=e.root,t=i.ref.imageViewBin.filter(function(e){return 0===e.opacity});i.ref.imageViewBin=i.ref.imageViewBin.filter(function(e){return 0<e.opacity}),t.forEach(function(e){return t=e,i.removeChildView(t),void t._destroy();var t}),t.length=0})})},i=function(e){var t=e.addFilter,i=e.utils,a=i.Type,n=i.createRoute,d=i.isFile,f=p(e);return t("CREATE_VIEW",function(e){var t=e.is,l=e.view,h=e.query;if(t("file")&&h("GET_ALLOW_IMAGE_PREVIEW")){var r=function(e,t){if(e.ref.imagePreview){var i=t.id,a=e.query("GET_ITEM",{id:i});if(a){var r=e.query("GET_PANEL_ASPECT_RATIO"),n=e.query("GET_ITEM_PANEL_ASPECT_RATIO"),o=e.query("GET_IMAGE_PREVIEW_HEIGHT");if(!(r||n||o)){var c=e.ref,s=c.imageWidth,l=c.imageHeight;if(s&&l){var h=e.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),d=e.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),f=(a.getMetadata("exif")||{}).orientation||-1;if(5<=f&&f<=8){var p=[l,s];s=p[0],l=p[1]}if(!y(a.file)){var u=2048/s;s*=u,l*=u}var g=l/s,E=(a.getMetadata("crop")||{}).aspectRatio||g,m=Math.max(h,Math.min(l,d)),v=e.rect.element.width,I=Math.min(v*E,m);e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:a.id,height:I})}}}}},i=function(e){var t=e.root,i=e.props;r(t,i)};l.registerWriter(n({DID_RESIZE_ROOT:i,DID_STOP_RESIZE:i,DID_LOAD_ITEM:function(e){var t=e.root,i=e.props.id,a=h("GET_ITEM",i);if(a&&d(a.file)&&!a.archived){var r=a.file;if(/^image/.test(r.type)){var n="createImageBitmap"in(window||{}),o=h("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!(!n&&o&&r.size>o)){t.ref.imagePreview=l.appendChildView(l.createChildView(f,{id:i}));var c=t.query("GET_IMAGE_PREVIEW_HEIGHT");c&&t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:a.id,height:c});var s=!n&&r.size>h("GET_IMAGE_PREVIEW_MAX_INSTANT_PREVIEW_FILE_SIZE");t.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:i},s)}}}},DID_IMAGE_PREVIEW_CALCULATE_SIZE:function(e){var t=e.root,i=e.props,a=e.action;t.ref.imageWidth=a.width,t.ref.imageHeight=a.height,r(t,i)},DID_UPDATE_ITEM_METADATA:function(e){var t=e.root,i=e.props;"crop"===e.action.change.key&&r(t,i)}}))}}),{options:{allowImagePreview:[!0,a.BOOLEAN],imagePreviewHeight:[null,a.INT],imagePreviewMinHeight:[44,a.INT],imagePreviewMaxHeight:[256,a.INT],imagePreviewMaxFileSize:[null,a.INT],imagePreviewMaxInstantPreviewFileSize:[1e6,a.INT],imagePreviewTransparencyIndicator:[null,a.STRING],imagePreviewCalculateAverageImageColor:[!1,a.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:i})),i});