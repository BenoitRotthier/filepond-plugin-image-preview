/*
 * FilePondPluginImagePreview 1.0.4
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginImagePreview=t()}(this,function(){"use strict";var e=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},t=(function(){function e(e){this.value=e}function t(t){function i(e,t){return new Promise(function(i,r){var c={key:e,arg:t,resolve:i,reject:r,next:null};o?o=o.next=c:(a=o=c,n(e,t))})}function n(i,a){try{var o=t[i](a),c=o.value;c instanceof e?Promise.resolve(c.value).then(function(e){n("next",e)},function(e){n("throw",e)}):r(o.done?"return":"normal",o.value)}catch(u){r("throw",u)}}function r(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}a=a.next,a?n(a.key,a.arg):o=null}var a,o;this._invoke=i,"function"!=typeof t["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype["throw"]=function(e){return this._invoke("throw",e)},t.prototype["return"]=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}),i={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:[0,1,1,0,0,0],6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},n=function(e,n,r,a){a!==-1&&e.transform.apply(e,t(i[a](n,r)))},r=function(e,t,i,r){if(r>=5&&r<=8){var a=[i,t];t=a[0],i=a[1]}var o=document.createElement("canvas"),c=o.getContext("2d");return r>=5&&r<=8?(o.width=i,o.height=t):(o.width=t,o.height=i),c.save(),n(c,t,i,r),c.drawImage(e,0,0,t,i),e.close&&e.close(),c.restore(),o},a={type:"spring",stiffness:.5,damping:.45,mass:10},o=function(e){return e.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,create:function(e){var t=e.root;t.ref.clip=document.createElement("div"),t.element.appendChild(t.ref.clip)},write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:function(e){var t=e.root,i=e.props,n=e.action,a=i.id,o=t.query("GET_ITEM",{id:i.id}),c=o.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:n.height/n.width},u=window.devicePixelRatio,d=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),l=t.rect.inner.width,s=n.height/n.width,f=l,h=l*s,p=r(n.data,f*u,h*u,n.orientation),v=Math.min(l*c.aspectRatio,d),E=v/c.aspectRatio;E>f&&(E=f,v=E*c.aspectRatio);var I=v/(h*c.rect.height),w=f*I,m=h*I,_=-c.rect.x*f*I,g=-c.rect.y*h*I;t.ref.clip.style.cssText="\n                    width:"+E+"px;\n                    height:"+v+"px;\n                ",p.style.cssText="\n                    width:"+w+"px;\n                    height:"+m+"px;\n                    transform:translate("+Math.round(_)+"px, "+Math.round(g)+"px);\n                ",t.ref.clip.appendChild(p),t.dispatch("DID_IMAGE_PREVIEW_DRAW",{id:a})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:a,scaleY:a,opacity:{type:"tween",duration:750}}}})},c=function(e,t){t.width=e.width,t.height=e.height;var i=t.getContext("2d");i.drawImage(e,0,0)},u=function(e){return e.utils.createView({name:"image-preview-overlay",tag:"canvas",ignoreRect:!0,create:function(e){var t=e.root,i=e.props;c(i.template,t.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}})},d=function(e,t){var i=new Image;i.onload=function(){t(i.naturalWidth,i.naturalHeight)},i.src=e},l=function(e,t,i,n){var r=Math.min(i/e,n/t);return{width:Math.round(e*r),height:Math.round(t*r)}},s=function(e,t,i,n){d(e,function(e,r){var a=l(e,r,t,i);n(a.width,a.height)})},f=function(){self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e])})};var e=function(e,t){fetch(e.file).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e)}).then(function(e){return t(e)})}},h=function(e){return-.5*(Math.cos(Math.PI*e)-1)},p=function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=1-a,c=t.join(","),u=0;u<=r;u++){var d=u/r,l=a+o*d;e.addColorStop(l,"rgba("+c+", "+n(d)*i+")")}},v=function(e,t,i,n,r){e.width=t,e.height=i;var a=e.getContext("2d"),o=.5*t,c=a.createRadialGradient(o,i+110,i-100,o,i+110,i+100);p(c,n,r,void 0,8,.4),a.save(),a.translate(.5*-t,0),a.scale(2,1),a.fillStyle=c,a.fillRect(0,0,t,i),a.restore()},E=500,I=200,w=document.createElement("canvas"),m=document.createElement("canvas"),_=document.createElement("canvas");v(w,E,I,[40,40,40],.85),v(m,E,I,[196,78,71],1),v(_,E,I,[54,151,99],1);var g=function(e){var t=u(e),i=function(t){var i=t.root,n=t.props,r=e.utils,a=(r.createView,r.createWorker),o=r.loadImage,c=n.id,u=i.query("GET_ITEM",c),d=URL.createObjectURL(u.file),l=u.getMetadata("exif")||{},h=l.orientation||-1,p=function(e,t,i,n){o(d).then(function(e){var r=document.createElement("canvas");r.width=t,r.height=i;var a=r.getContext("2d");a.drawImage(e,0,0,t,i),v(r,t,i,n)})},v=function(e,t,n,r){URL.revokeObjectURL(d),i.dispatch("DID_IMAGE_PREVIEW_LOAD",{id:c,data:e,width:t,height:n,orientation:r})},E=i.rect.element.width*window.devicePixelRatio*2,I=E;s(d,E,I,function(e,t){if(h>=5&&h<=8){var n=[t,e];e=n[0],t=n[1]}if(i.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:c,width:e,height:t}),"createImageBitmap"in window){var r=a(f);r.post({file:d},function(i){return i?(v(i,e,t,h),void r.terminate()):void p(u,e,t,h)})}else p(u,e,t,h)})},n=function(e){var t=e.root;t.ref.overlayShadow.opacity=1},r=function(e){var t=e.root,i=t.ref.image;i.scaleX=1,i.scaleY=1,i.opacity=1},a=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},c=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1},d=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},l=function(i){var n=i.root,r=i.props,a=r.id,c=o(e);n.ref.image=n.appendChildView(n.createChildView(c,{id:r.id,scaleX:1.25,scaleY:1.25,opacity:0})),n.ref.overlayShadow=n.appendChildView(n.createChildView(t,{template:w,opacity:0})),n.ref.overlaySuccess=n.appendChildView(n.createChildView(t,{template:_,opacity:0})),n.ref.overlayError=n.appendChildView(n.createChildView(t,{template:m,opacity:0})),n.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:a})};return e.utils.createView({name:"image-preview-wrapper",create:l,write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:n,DID_IMAGE_PREVIEW_DRAW:r,DID_IMAGE_PREVIEW_CONTAINER_CREATE:i,DID_THROW_ITEM_LOAD_ERROR:c,DID_THROW_ITEM_PROCESSING_ERROR:c,DID_THROW_ITEM_INVALID:c,DID_COMPLETE_ITEM_PROCESSING:d,DID_START_ITEM_PROCESSING:a,DID_REVERT_ITEM_PROCESSING:a})})},y=function(t){var i=t.addFilter,n=t.utils,r=n.Type,a=n.createRoute,o=g(t);return i("CREATE_VIEW",function(i){var n=i.is,r=i.view,c=i.query;if(n("file")&&c("GET_ALLOW_IMAGE_PREVIEW")){var u=function(i){var n=i.root,a=i.props,u=a.id,d=c("GET_ITEM",u);if(d){var l=d.file;if(e(l)){var s="createImageBitmap"in(window||{}),f=c("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");if(!(!s&&f&&l.size>f)){var h=t.views.panel;n.ref.panel=r.appendChildView(r.createChildView(h)),n.ref.panel.element.classList.add("filepond--panel-item"),n.ref.panel.height=10,n.ref.imagePreview=r.appendChildView(r.createChildView(o,{id:u}))}}}},d=function(e){var t=e.root,i=e.props,n=e.action,r=t.query("GET_ITEM",{id:i.id}),a=r.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:n.height/n.width},o=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),c=Math.min(n.height,o),u=c/a.aspectRatio;u>t.rect.element.width&&(u=t.rect.element.width,c=u*a.aspectRatio),t.ref.imagePreview.element.style.cssText="height:"+c+"px",t.ref.panel.height=c};r.registerWriter(a({DID_LOAD_ITEM:u,DID_IMAGE_PREVIEW_CALCULATE_SIZE:d}))}}),{options:{allowImagePreview:[!0,r.BOOLEAN],imagePreviewMaxHeight:[256,r.INT],imagePreviewMaxFileSize:[null,r.INT]}}};return document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:y})),y});